<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Verify — Sami-S.dev</title>

<!-- Replace with your actual site key for sami-s.dev -->
<script src="https://www.google.com/recaptcha/api.js?render=6Lep_HYsAAAAAAerNedHFNuVPuaF5JpH-dFxF6ft"></script>

<style>
  body { font-family: Arial, sans-serif; display: flex; justify-content:center; align-items:center; height:100vh; background:#071428; color:#e6eef6; margin:0;}
  .card { background:#0b1220; padding:30px; border-radius:12px; text-align:center; max-width:400px;}
  button { margin-top:20px; padding:10px 20px; border-radius:8px; border:none; background:#6ee7b7; color:#042028; font-weight:bold; cursor:pointer;}
  .error { color:#ff8b8b; margin-top:12px; display:none; }
</style>
</head>
<body>
  <div class="card">
    <h2>Human verification</h2>
    <p id="status">Performing invisible reCAPTCHA v3 check…</p>
    <button id="retryBtn" style="display:none;">Try Again</button>
    <div id="errorMsg" class="error"></div>
  </div>

<script>
const SITE_KEY = "6Lep_HYsAAAAAAerNedHFNuVPuaF5JpH-dFxF6ft";
const STORAGE_KEY = "user-verified";
const TTL_MS = 24*60*60*1000; // 24h session validity

const statusEl = document.getElementById('status');
const retryBtn = document.getElementById('retryBtn');
const errorEl = document.getElementById('errorMsg');

function redirectIndex() {
  window.location.href = 'index.html';
}

function verifyRecaptcha() {
  if (!window.grecaptcha) {
    errorEl.textContent = "reCAPTCHA not loaded. Refresh the page.";
    errorEl.style.display = "block";
    retryBtn.style.display = "inline-block";
    return;
  }

  grecaptcha.ready(() => {
    grecaptcha.execute(SITE_KEY, { action: 'homepage' }).then(token => {
      // Token obtained, assume verification (static-only)
      sessionStorage.setItem(STORAGE_KEY, JSON.stringify({ ts: Date.now(), token }));
      redirectIndex();
    }).catch(err => {
      console.error(err);
      errorEl.textContent = "reCAPTCHA execution failed.";
      errorEl.style.display = "block";
      retryBtn.style.display = "inline-block";
    });
  });
}

// Retry button
retryBtn.addEventListener('click', () => {
  errorEl.style.display = 'none';
  retryBtn.style.display = 'none';
  verifyRecaptcha();
});

// If already verified and within TTL, skip
try {
  const raw = sessionStorage.getItem(STORAGE_KEY);
  if (raw) {
    const obj = JSON.parse(raw);
    if (Date.now() - obj.ts < TTL_MS) redirectIndex();
  }
} catch(e){ console.warn("Failed to parse session storage"); }

verifyRecaptcha();
</script>
</body>
</html>
